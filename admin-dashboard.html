<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Dashboard - Hộp Thư</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        body { background: #f4f4f4; }
        .sidebar { width: 250px; background: var(--primary); color: white; height: 100vh; position: fixed; padding: 20px; }
        .sidebar a { color: white; display: block; padding: 12px; margin-bottom: 5px; border-radius: 4px; }
        .sidebar a.active, .sidebar a:hover { background: var(--accent); }
        .main-content { margin-left: 250px; padding: 40px; }
        
        /* Table Style */
        .inbox-table { width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .inbox-table th, .inbox-table td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
        .inbox-table th { background: var(--bg-alt); font-weight: bold; color: var(--primary); }
        .inbox-table tr:hover { background: #fafafa; }
        .msg-content { max-width: 300px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: #666; }
    </style>
    <script>
        if(localStorage.getItem('isAdmin') !== 'true') window.location.href = 'admin-portal-v2.html';
    </script>
</head>
<body>

    

    <div class="main-content">
        <h2 class="section-title" style="text-align: left;">Hộp Thư Đến</h2>
        <p style="margin-bottom: 20px;">Danh sách tin nhắn từ trang Liên hệ</p>

        <table class="inbox-table">
            <thead>
                <tr>
                    <th width="150">Ngày gửi</th>
                    <th width="150">Họ tên</th>
                    <th width="200">Email/SĐT</th>
                    <th>Nội dung</th>
                    <th width="100">Hành động</th>
                </tr>
            </thead>
            <tbody id="msg-body">
                </tbody>
        </table>
        <p id="empty-msg" style="text-align: center; margin-top: 20px; display: none;">Chưa có tin nhắn nào.</p>
    </div>

    <script src="js/db.js"></script>
    <script>
        function renderMessages() {
            const list = getContacts();
            const tbody = document.getElementById('msg-body');
            
            if(list.length === 0) {
                document.getElementById('empty-msg').style.display = 'block';
                tbody.innerHTML = '';
                return;
            }

            // Sắp xếp tin nhắn mới nhất lên đầu
            list.sort((a, b) => b.id - a.id);

            tbody.innerHTML = list.map(c => `
                <tr>
                    <td style="font-size: 0.9rem; color: #888;">${c.date || 'Vừa xong'}</td>
                    <td><strong>${c.name}</strong></td>
                    <td>
                        <div>${c.email}</div>
                        <div style="font-size: 0.85rem; color: #666;">${c.phone}</div>
                    </td>
                    <td><div class="msg-content" title="${c.message}">${c.message}</div></td>
                    <td>
                        <button onclick="handleDelMsg(${c.id})" style="color: #d9534f; border: none; background: none; cursor: pointer; font-weight: bold;">Xóa</button>
                    </td>
                </tr>
            `).join('');
        }

        function handleDelMsg(id) {
            if(confirm('Xóa tin nhắn này?')) {
                deleteContact(id);
                renderMessages();
            }
        }

        renderMessages();
    </script>
</body>
</html>
