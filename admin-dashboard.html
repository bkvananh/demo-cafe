<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Hộp Thư</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="js/admin.js"></script>
    <script>checkGatekeeper();</script>
</head>
<body id="admin-body">
    <div id="admin-sidebar"></div>
    <div id="admin-content">
        <h2>Hộp Thư Khách Hàng</h2>
        
        <table class="admin-table">
            <thead>
                <tr>
                    <th width="150">Ngày gửi</th>
                    <th width="150">Họ tên</th>
                    <th width="150">Liên hệ</th>
                    <th>Nội dung</th>
                    <th width="80">Xóa</th>
                </tr>
            </thead>
            <tbody id="list"></tbody>
        </table>
        
        <p id="empty" style="text-align:center; margin-top:20px; display:none; color:#888;">Hộp thư trống.</p>
    </div>

    <script src="js/db.js"></script>
    <script src="js/components.js"></script>
    <script>
        function renderMessages() {
            // 1. Lấy dữ liệu tin nhắn từ LocalStorage
            const list = getData(CONTACTS_KEY);
            
            // 2. Kiểm tra nếu không có tin nhắn
            if(!list || list.length === 0) {
                document.getElementById('empty').style.display = 'block';
                return;
            }

            // 3. Vẽ ra bảng HTML
            document.getElementById('list').innerHTML = list.map(c => `
                <tr>
                    <td><small>${c.date}</small></td>
                    <td><strong>${c.name}</strong></td>
                    <td>${c.contact}</td>
                    <td>${c.message}</td>
                    <td>
                        <button onclick="del(${c.id})" style="color:red; border:none; background:none; cursor:pointer;">Xóa</button>
                    </td>
                </tr>`).join('');
        }
        
        // Hàm xóa tin nhắn
        function del(id) { 
            if(confirm('Bạn có chắc muốn xóa tin nhắn này?')) { 
                deleteData(CONTACTS_KEY, id); 
                location.reload(); 
            } 
        }

        // Chạy hàm hiển thị ngay khi mở trang
        renderMessages();
    </script>
</body>
</html>
